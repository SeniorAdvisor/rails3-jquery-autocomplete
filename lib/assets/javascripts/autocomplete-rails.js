(function(c){function b(e){var f={};var g=e.split(";");for(var d=0;d<g.length;d++){var h=g[d].split(":");f[h[0]]=h[1]}return f}var a=null;c.fn.railsAutocomplete=function(){var d=function(){if(!this.railsAutoCompleter){this.railsAutoCompleter=new c.railsAutocomplete(this)}};if(c.fn.on!==undefined){return c(document).on("focus",this.selector,d)}else{return this.live("focus",d)}};c.railsAutocomplete=function(d){_e=d;this.init(_e)};c.railsAutocomplete.fn=c.railsAutocomplete.prototype={railsAutocomplete:"0.0.1"};c.railsAutocomplete.fn.extend=c.railsAutocomplete.extend=c.extend;c.railsAutocomplete.fn.extend({init:function(f){f.delimiter=c(f).attr("data-delimiter")||null;function d(e){return e.split(f.delimiter)}function g(e){return d(e).pop().replace(/^\s+/,"")}c(f).autocomplete({delay:c(f).attr("data-autocomplete-delay"),source:function(k,e){var l={term:g(k.term)};var i=c(f).attr("filter-conditions");if(i){var j=b(i);for(var h in j){var m=c("#"+j[h]).val();l[h]=m}}c.getJSON(c(f).attr("data-autocomplete"),l,function(){var n=Array.prototype.slice.call(arguments,0);if(n[0].length==0){n[0]=[];n[0][0]={id:"",label:"no existing match"}}c(n[0]).each(function(o,p){var q={};q[p.id]=p;c(f).data(q)});e.apply(null,n)})},change:function(h,j){if(c(c(this).attr("data-id-element")).val()==""){return}c(c(this).attr("data-id-element")).val(j.item?j.item.id:"");if(c(this).attr("data-update-elements")){var k=c.parseJSON(c(this).attr("data-update-elements"));var i=j.item?c(this).data(j.item.id.toString()):{};if(k&&c(k.id).val()==""){return}for(var e in k){c(k[e]).val(j.item?i[e]:"")}}},search:function(){var e=g(this.value);if(e.length<2){return false}},focus:function(){return false},select:function(i,l){var h=d(this.value);h.pop();h.push(l.item.value);if(f.delimiter!=null){h.push("");this.value=h.join(f.delimiter)}else{this.value=h.join("");if(c(this).attr("data-id-element")){c(c(this).attr("data-id-element")).val(l.item.id)}if(c(this).attr("data-update-elements")){var k=c(this).data(l.item.id.toString());var m=c.parseJSON(c(this).attr("data-update-elements"));for(var e in m){c(m[e]).val(k[e])}}}var j=this.value;c(this).bind("keyup.clearId",function(){if(c.trim(c(this).val())!=c.trim(j)){c(c(this).attr("data-id-element")).val("");c(this).unbind("keyup.clearId")}});c(f).trigger("railsAutocomplete.select",l);return false}})}});c(document).ready(function(){c("input[data-autocomplete]").railsAutocomplete()})})(jQuery);